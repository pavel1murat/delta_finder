//-----------------------------------------------------------------------------
// ordered Z-coordinates of the tracker layers
//-----------------------------------------------------------------------------
#include "TH2F.h"
#include "TBox.h"

#include "canvas/Persistency/Provenance/ProductID.h"
#include "Stntuple/geom/tracker_geom.hh"
#include "Offline/CalPatRec/inc/DeltaFinder_types.hh"

float z[144] = {
  -1518.320, -1512.908, -1495.786, -1490.374, -1467.626, -1462.214, -1445.092, -1439.680, -1344.320, -1338.908,
  -1321.786, -1316.374, -1293.626, -1288.214, -1271.092, -1265.680, -1170.320, -1164.908, -1147.786, -1142.374,
  -1119.626, -1114.214, -1097.092, -1091.680,  -996.320,  -990.908,  -973.786,  -968.374,  -945.626,  -940.214,
   -923.092,  -917.680,  -822.320,  -816.908,  -799.786,  -794.374,  -771.626,  -766.214,  -749.092,  -743.680,
   -648.320,  -642.908,  -625.786,  -620.374,  -597.626,  -592.214,  -575.092,  -569.680,  -474.320,  -468.908,
   -451.786,  -446.374,  -423.626,  -418.214,  -401.092,  -395.680,  -300.320,  -294.908,  -277.786,  -272.374,
   -249.626,  -244.214,  -227.092,  -221.680,  -126.320,  -120.908,  -103.786,   -98.374,   -75.626,   -70.214,
    -53.092,   -47.680,    47.680,    53.092,    70.214,    75.626,    98.374,   103.786,   120.908,   126.320,
    221.680,   227.092,   244.214,   249.626,   272.374,   277.786,   294.908,   300.320,   395.680,   401.092,
    418.214,   423.626,   446.374,   451.786,   468.908,   474.320,   569.680,   575.092,   592.214,   597.626,
    620.374,   625.786,   642.908,   648.320,   743.680,   749.092,   766.214,   771.626,   794.374,   799.786,
    816.908,   822.320,   917.680,   923.092,   940.214,   945.626,   968.374,   973.786,   990.908,   996.320,
   1091.680,  1097.092,  1114.214,  1119.626,  1142.374,  1147.786,  1164.908,  1170.320,  1265.680,  1271.092,
   1288.214,  1293.626,  1316.374,  1321.786,  1338.908,  1344.320,  1439.680,  1445.092,  1462.214,  1467.626,
   1490.374,  1495.786,  1512.908,  1518.320
};

/* output - ordered Z-coordinaes of the faces

 -1515.614  -1493.080  -1464.920  -1442.386  -1341.614  -1319.080  -1290.920  -1268.386  -1167.614  -1145.080 
 -1116.920  -1094.386   -993.614   -971.080   -942.920   -920.386   -819.614   -797.080   -768.920   -746.386 
  -645.614   -623.080   -594.920   -572.386   -471.614   -449.080   -420.920   -398.386   -297.614   -275.080 
  -246.920   -224.386   -123.614   -101.080    -72.920    -50.386     50.386     72.920    101.080    123.614 
   224.386    246.920    275.080    297.614    398.386    420.920    449.080    471.614    572.386    594.920 
   623.080    645.614    746.386    768.920    797.080    819.614    920.386    942.920    971.080    993.614 
  1094.386   1116.920   1145.080   1167.614   1268.386   1290.920   1319.080   1341.614   1442.386   1464.920 
  1493.080   1515.614 
*/

float z_face[72];
//-----------------------------------------------------------------------------
void tracker_z() {
  int face=0;
  int ind = 0;
  
  for(int i=0; i<144; i+=2) {
    z_face[face] = (z[i]+z[i+1])/2.;

    printf("%10.3f ",z_face[face]);
    ind += 1;
    if (ind == 10) {
      printf("\n");
      ind = 0;
    }
    face++;
  }
}

//-----------------------------------------------------------------------------
// code here needs a significant cleanup
int display_phi_z_map() {
  TH2F* h_pz = new TH2F("h_pz","pz map", 3200,-1600,1600,360,-180,180);

  h_pz->Draw();

  tracker_z();
  mu2e::DeltaFinderTypes::ChannelID x, o;

  int color[3] = { kRed, kGreen, kBlue };
  
  for (int is=0; is<18; is++) {
    o.Station = is;
    printf("St:Pln:Face:Pnl: St:Pln:Face:Pnl       Z   phi   ireg phimin  phimax \n");
    printf("-------------------------------------------\n");
    for (int zface=0; zface<4; zface++) {
      o.Plane = 2*is+zface/2;
      o.Face  = zface;
      for (int ipn=0; ipn<3; ipn++) {
        o.Panel = ipn;
        mu2e::DeltaFinderTypes::Data_t::deOrderID(&x,&o);
          
        int iss = is %2 ;
        int iff = is*4+zface;
          
        stntuple::LayerGeom_t* lg = &stntuple::lgeom[iss][x.Plane][x.Face][x.Panel];

        float phi  = lg->phi;
        int   nreg = 1;

        float phimin[2], phimax[2];
          
        phimin[0] = phi-60;
        phimax[0] = phi+60;

        if (phimin[0] < -180) {
          nreg = 2;
          phimin[0] = phimin[0]+360;
          phimin[1] = -180;
          phimax[1] = phimax[0];
          phimax[0] = 180;
        }
        else if (phimax[0] > 180) {
          nreg = 2;
          phimin[1] = -180;
          phimax[1] = phimax[0]-360;
          phimax[0] = 180;
        }

        float sc = 1.; //  M_PI/180.;
          
        for (int ireg=0; ireg<nreg; ireg++) {
          TBox* b = new TBox(z_face[iff]-10, phimin[ireg]*sc, z_face[iff]+10, phimax[ireg]*sc);
          b->SetFillColor(color[ipn]);
          b->SetFillStyle(3002);
          b->Draw();
          
          printf("%2i:%2i:%2i:%2i  --> %2i:%2i:%2i:%2i  %8.3f %6.2f %3i %6.2f %6.2f \n",
                 o.Station,o.Plane,o.Face,o.Panel,
                 x.Station,x.Plane,x.Face,x.Panel,
                 z_face[iff], phi, ireg, phimin[ireg], phimax[ireg]
                 );
        }
      }
    }
  }

  return 0;
}
